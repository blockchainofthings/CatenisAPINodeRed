<script type="text/javascript">
    RED.nodes.registerType('read message', {
        category: 'catenis flow',
        color: '#9f9fe4',
        defaults: {
            name: { value: "" },
            device: { value: "", type: "catenis device", required: true },
            encoding: { value: "utf8" }
        },
        inputs:1,
        outputs:1,
        icon: "catenis-read-message.png",
        label: function () {
            return this.name || "read message";
        }
    });
</script>

<script type="text/x-red" data-template-name="read message">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-device"><i class="fa fa-microchip"></i> Device</label>
        <input type="text" id="node-input-device">
    </div>
    <div class="form-row">
        <label for="node-input-encoding"><i class="fa fa-font"></i> Encoding</label>
        <select id="node-input-encoding">
            <option value="utf8" selected>UTF-8</option>
            <option value="base64">Base-64</option>
            <option value="hex">Hex</option>
        </select>
    </div>
</script>

<script type="text/x-red" data-help-name="read message">
    <p>Call Catenis API "Read Message" method to read a given message from the blockchain.</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">string</span></dt>
        <dd>The ID of the message to read</dd>
    </dl>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object</span></dt>
        <dt style="margin-left:1em">messageId<span class="property-type">string</span></dt>
        <dd style="margin-left:1.5em">ID of the message to read</dd>
        <dt style="margin-left:1em">encoding<span class="property-type">string</span></dt>
        <dd style="margin-left:1.5em">Encoding that should be used for the returned message. One of: <code>utf8</code>, <code>base64</code>, <code>hex</code></dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object</span></dt>
        <dt style="margin-left:1em">action<span class="property-type">object</span></dt>
        <dd style="margin-left:1.5em">One of: <code>log</code>, <code>send</code></dd>
        <dt style="margin-left:1em" class="optional">from<span class="property-type">object</span></dt>
        <dt style="margin-left:2em">deviceId<span class="property-type">string</span></dt>
        <dt style="margin-left:2em" class="optional">name<span class="property-type">string</span></dt>
        <dt style="margin-left:2em" class="optional">prodUniqueId<span class="property-type">string</span></dt>
        <dt style="margin-left:1em">message<span class="property-type">string</span></dt>
        <dd style="margin-left:1.5em">Message formatted using the specified encoding</dd>
    </dl>
    <h3>Details</h3>
    <p>The configuration settings (except for Name and Device) are used to set the default for the corresponding parameters of the Catenis API method.</p>
    <p>The payload of the received message can be either a string or an object. If it is a string, its contents is used as the ID of the message to read and the default settings (as specified in the node’s configuration) are used for the other parameters.</p>
    <p>In case an object is received, the ID of the message to read and the other parameters are gotten from it. Any parameter present in the message payload supersedes the default settings (as specified in the node’s configuration).</p>
    <p>The data returned from a successful call to the Catenis API method are passed through the node’s single output.</p>
    <h3>References</h3>
    <ul>
        <li><a target="catenis_docs" href="https://catenis.com/docs/api">Catenis Enterprise API Docs</a> - complete information about Catenis Enterprise API</li>
    </ul>
</script>
